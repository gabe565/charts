#
# IMPORTANT NOTE
#
# This chart inherits from our common library chart. You can check the default values/options here:
# https://github.com/bjw-s/helm-charts/blob/a081de5/charts/library/common/values.yaml
#

controllers:
  main:
    type: statefulset
    # -- Enable devices to be discoverable
    hostNetwork: false
    containers:
      main:
        image:
          repository: ghcr.io/home-assistant/home-assistant
          pullPolicy: IfNotPresent
          tag: 2024.1.3

      codeserver:
        dependsOn: main
        image:
          repository: ghcr.io/coder/code-server
          pullPolicy: IfNotPresent
          tag: 4.20.0
        args:
          - --auth
          - "none"
          - --user-data-dir
          - "/config/.vscode"
          - --extensions-dir
          - "/config/.vscode"
          - --port
          - "8081"
          - "/config"

      # matter
      # - homeassistant/aarch64-addon-matter-server:502
      # MQTT:
      #  - homeassistant/aarch64-addon-mosquitto:6.4.0
      # whisper
      # - homeassistant/aarch64-addon-whisper:1.0.2
      # assist_microphone
      # - homeassistant/aarch64-addon-assist_microphone:1.0.0
      # piper
      # - homeassistant/aarch64-addon-piper:1.4.0
      # zwave_js
      # - homeassistant/aarch64-addon-zwave_js:0.4.3
      # openwakeword
      # - homeassistant/aarch64-addon-openwakeword:1.8.2

    mqtt:
      enabled: false
      containers:
        main:
          image: homeassistant/aarch64-addon-mosquitto
          tag: 6.4.0
          enabled: false
          volumeMounts:
            - name: mqtt-config
              mountPath: /mosquitto/config
            - name: mqtt-data
              mountPath: /mosquitto/data
            - name: mqtt-log
              mountPath: /mosquitto/log

env:
  TZ: UTC

# -- Configures service settings for the chart.
service:
  main:
    ports:
      http:
        port: 8123

ingress:
  # Ingress for the main application
  main:
    enabled: true
    # ingressClassName: "external-nginx"
    annotations: {}
    hosts:
      - host: &host-main "hass.example.local"
        paths:
          - path: /
            pathType: Prefix
            service:
              name: main
              port: http
    tls:
      - hosts:
          - *host-main

  #  Ingress for code-server sidecar
  code:
    enabled: true
    # ingressClassName: "internal-nginx"
    annotations: {}
    hosts:
      - host: &host-code "hass-code.example.local"
        paths:
          - path: /
            pathType: Prefix
            service:
              name: code
              port: http
    tls:
      - hosts:
          - *host-code

persistence:
  config:
    enabled: true
    # existingClaim: home-assistant-config
    globalMounts:
      - path: /config

  mqtt:
    advancedMounts:
      mqtt:
        mqtt:
          - name: mqtt-config
            mountPath: /mosquitto/config
          - name: mqtt-data
            mountPath: /mosquitto/data
          - name: mqtt-log
            mountPath: /mosquitto/log
            # readOnly: true
  # Configure an NFS mount to store backups on
  # backup:
  #   enabled: true
  #   type: nfs-csi
  #   server: nas.example.lan
  #   path: /volume/Backups/k8s/hass
  #   globalMounts:
  #     - path: /config/backups
